{% extends 'base.html' %}

{% block meta %}
<style>
    .image-container {
        width: 100px;  /* Set your desired width */
        height: 150px; /* Set your desired height */
        overflow: hidden;
    }

    .image-container img {
        width: 100%;
        height: auto;
        object-fit: cover;
    }
    #app-title {
        font-family: 'Kidstock';
        font-weight: bold;
        color: #011627ff;
        font-size: 8vh;
        margin-bottom: 4vh;
    }
    .filter-links {
        padding-right: 1vw;
    }
    .grid-container {
        display: grid;
        grid-template-columns: 0.5fr 4fr 1fr;
        grid-gap: 24px;
    }
    .btn-primary {
        background-color: #2ec4b6ff !important;
        border-color: #2ec4b6ff !important;
    }
    .filter-links {
        color: #e71d36ff;
    }

    .filter-links:hover {
        color: #bd1429;
        text-decoration: none;
        font-size: large;
        font-weight: bold;
    }
</style>
{% endblock meta %}

{% block content %}
<div class="content">
    <h1 id="app-title">MyBooks</h1>

    <div class="grid-container">

        <div class="grid-child">
            <div class="filters">
                <p style="font-weight: bold;">Sort by Genre</p>
        
                <a class="filter-links" href="/mybooks/">
                    All
                </a>
                <br/>
                <br/>

            
                {% for category in categories %}
                <a class="filter-links" href="/mybooks/filter/{{ category.0 }}/">
                    {{ category.1 }}
                </a>
                <br/>
                <br/>
                {% endfor %}
            </div>
        </div>
        
        <div class="grid-child">

            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Cover</th>
                        <th scope="col">Title</th>
                        <th scope="col">Author</th>
                        <th scope="col">Category</th>
                        <th scope="col">Review</th>
                        <th scope="col">Remove</th>
                </thead>
                <tbody id="table_content"></tbody> 
            </table>

        </div>
    </div>






    <!-- <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Review</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="requestForm" onsubmit="return false;">

                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="book_title" class="col-form-label">Book Title:</label>
                            <input type="text" class="form-control" id="book_title" name="book_title"></input>
                        </div>
                        <div class="mb-3">
                            <label for="book_author" class="col-form-label">Book Author:</label>
                            <input type="text" class="form-control" id="book_author" name="book_author"></input>
                        </div>
                        <div class="mb-3">
                            <label for="reason" class="col-form-label">Reason for Request:</label>
                            <textarea class="form-control" id="reason" name="reason"></textarea>
                        </div>

                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="button_add" data-bs-dismiss="modal">Submit Request</button>
                </div>
            </div>
        </div>
    </div> -->

</div>
        
<script>
    async function getBookmarks() {
        return fetch("{% url 'mybooks:get_bookmark_json' %}").then((res) => res.json())
    }
    async function refreshBookmarks() {
        document.getElementById("table_content").innerHTML = "";
        const products = await getBookmarks();
        let htmlString = "";
        console.log(products)
        products.forEach((book, index) => {
            htmlString += `
                <tr>
                    <th scope="row">${index + 1}</th>
                    <td>
                        <div class="image-container">
                            <img src="${book.fields.image_url}"/>
                        </div>
                    </td>
                    <td>${book.fields.title}</td>
                    <td>${book.fields.author}</td>
                    <td>${book.fields.category}</td>
                    <td>
                        <button type="submit" class="btn btn-primary">Review</button>
                    </td>
                    <td>
                        <button type="submit" class="btn btn-danger" onclick="{removeBookmark(${book.pk})}">Remove</button>
                    </td>
                </tr>
            `;
        });
        document.getElementById("table_content").innerHTML = htmlString;
    }
    refreshBookmarks()

    function removeBookmark(id) {
        fetch("{%url 'mybooks:remove_bookmark' %}", {
            method: "DELETE",
            body: JSON.stringify({ id: id })
        }).then(refreshBookmarks)
    }
</script>


{% endblock content %}