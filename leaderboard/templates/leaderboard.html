{% extends 'base.html' %}
<!DOCTYPE html>
<html>
{% block content %}
    <style>
        .image-container {
            width: 100px;  /* Set your desired width */
            height: 150px; /* Set your desired height */
            overflow: hidden;
        }

        .image-container img {
            width: 100%;
            height: auto;
            object-fit: cover;
        }
        table{
            justify-content: center;
            text-align: center;
        }
        button{
            border: transparent;
            background-color : #e71d36ff;
            size:3cm;
            color :aliceblue
        }
        button:hover{
            background-color: #ff9f1cff;
            border : transparent;
        }
    </style>


<div class="content"> 
    <h1 id="app-title" style="text-align: center;">Leaderboard</h1>
    <h3 style="text-align: center; font-size: small;"> Overall only shows the Top 10</h3>
    <h5 style="text-align: center; font-size: smaller;"> You can rate your favourite books in each genre</h5>
    <div id="filters">

        <p style="font-weight: bold;">By Genre</p>

        <a class="filter-links" href="/leaderboard/">
            Overall
        </a>
        &nbsp;
        &nbsp;
        &nbsp;
    
        {% for category in categories %}
        <a class="filter-links" href="/leaderboard/filter/{{ category.0 }}/">
            {{ category.1 }}   
        </a>
        &nbsp;
        &nbsp;  
        &nbsp;  
        {% endfor %}
    </div>

    <div>
        <table id="item_table">
            <tr style="text-align: center;">
                <th>No.</th>
                <th>Cover</th>
                <th>Title</th>
                <th>Author</th>
                <th>Category</th>
                <th>Rate</th>
            </tr>
    
            {% for product in products %}
            <tr>
                <td>{{forloop.counter}}</td>
                <td>
                    <div class="image-container">
                        <img src="{{product.image_url}}"/>
                    </div>
                </td>
                <td>{{product.title}}</td>
                <td>{{product.author}}</td>
                <td>{{product.category}}</td>
                <td id="rate{{product.id}}">{{product.rate}}
                    <button type="button" onclick="rateBook({{product.id}})">â™¡</button>
                </td>
            </tr>
            {% endfor %}
        </table>
    
        <script type="text/javascript">
            function rateBook(bookId) {
                $.ajax({
                    url: '/rate_button/',
                    type: 'POST',
                    data: {
                        'book_id': bookId,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function(data) {
                        if (data.success) {
                            $.ajax({
                                url: document.URL,
                                type: 'GET',
                                success: function(response) {
                                    $('#item_table').html($(response).find('#item_table').html());
                                }
                            });
                        }
                    }
                });
            }
        </script>
    </div>
    
    
</div>

</html>

<script>
function rateBook(bookId) {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      document.getElementById("rate" + bookId).innerHTML =
      parseInt(document.getElementById("rate" + bookId).innerHTML) + 1;
      location.reload(true);
    }
  };
  xhttp.open("POST", "{% url 'leaderboard:rate_button' %}", true);
  xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
  xhttp.send("book_id=" + bookId + "&csrfmiddlewaretoken={{ csrf_token }}");
}


</script>



{% endblock content %}